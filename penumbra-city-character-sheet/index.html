<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penumbra City Character Sheet</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            background: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .character-sheet {
            max-width: 1200px;
            margin: 0 auto;
            background: #2a2a2a;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #333;
            border-radius: 6px;
            border-left: 4px solid #8b4513;
        }
        .section h2 {
            margin: 0 0 20px 0;
            color: #d4af37;
            font-size: 1.5em;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 10px;
        }
        .top-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .field {
            display: flex;
            flex-direction: column;
        }
        .field label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #d4af37;
        }
        /* Consolidated input styles for all form elements */
        .field input, .field select, 
        .score-inputs input,
        .list-item input,
        .favor-item input,
        .reputation-item input,
        .ability-title,
        .ability-description {
            padding: 8px 12px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #444;
            color: #e0e0e0;
            font-size: 14px;
            box-sizing: border-box;
        }
        /* Consolidated focus styles for all form elements */
        .field input:focus, .field select:focus,
        .score-inputs input:focus,
        .list-item input:focus,
        .favor-item input:focus,
        .reputation-item input:focus,
        .ability-title:focus,
        .ability-description:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
        }
        .ability-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .ability-score {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #555;
        }
        .ability-score h3 {
            margin: 0 0 15px 0;
            color: #d4af37;
            text-align: center;
        }
        .score-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        .score-inputs input {
            text-align: center;
            font-weight: bold;
            width: 100%;
        }
        
        /* NumericInput component specific styles */
        .favor-item input,
        .reputation-item input {
            width: 80px;
            text-align: center;
        }
        .advantage-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .advantage-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #d4af37;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .editable-list {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #555;
        }
        .list-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: #444;
            border-radius: 4px;
        }
        .list-item input {
            flex: 1;
            /* Global styles now handle the appearance */
        }
        .list-item button {
            background: #d63031;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        .list-item button:hover {
            background: #b71540;
        }
        .ability-item {
            background: #444;
            border-radius: 4px;
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #555;
        }
        .ability-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .ability-title {
            flex: 1;
            font-weight: bold;
            /* Global styles now handle the appearance */
        }
        .ability-description {
            width: 100%;
            /* Global styles now handle the appearance */
        }
        /* Remove button styling - consolidated for all remove buttons */
        .remove-btn, .list-item button, .ability-item button {
            background: #d63031;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-btn:hover, .list-item button:hover, .ability-item button:hover {
            background: #b71540;
        }
        
        /* Global input and textarea styling */
        input, textarea, select {
            background: #555;
            border: 1px solid #777;
            color: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        input::placeholder, textarea::placeholder {
            color: #aaa;
        }
        
        /* Specific input types */
        input[type="text"], input[type="number"] {
            min-height: 36px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            min-height: auto;
            cursor: pointer;
        }
        
        input[type="checkbox"]:checked {
            accent-color: #d4af37;
        }
        
        /* Number inputs */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
            background: #777;
            border-radius: 2px;
        }
        
        /* Textarea specific */
        textarea {
            resize: vertical;
            min-height: 60px;
            line-height: 1.4;
        }
        
        /* Select dropdowns */
        select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23d4af37' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }
        
        /* Override existing specific styles to ensure consistency */
        .list-item input, .ability-title, .ability-description {
            background: #555;
            border: 1px solid #777;
            color: #fff;
        }
        
        .list-item input:focus, .ability-title:focus, .ability-description:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        .add-item {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .add-item input {
            flex: 1;
            /* Global styles now handle the appearance */
        }
        .add-item button {
            background: #00b894;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: bold;
        }
        .add-item button:hover {
            background: #00a085;
        }
        
        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 20px;
            color: #888;
            font-style: italic;
            background: #444;
            border-radius: 4px;
        }
        
        .empty-state p {
            margin: 0;
            font-size: 14px;
        }
        .favor-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .favor-group {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #555;
        }
        .favor-group h3 {
            margin: 0 0 15px 0;
            color: #d4af37;
            text-align: center;
        }
        .favor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #555;
        }
        .favor-item:last-child {
            border-bottom: none;
        }
        .favor-item input {
            width: 60px;
            text-align: center;
        }
        .reputation-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .reputation-item {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #555;
            text-align: center;
        }
        .reputation-item h3 {
            margin: 0 0 15px 0;
            color: #d4af37;
        }
        .reputation-item input {
            width: 80px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .save-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #d4af37;
            color: #1a1a1a;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .save-button:hover {
            background: #b8941f;
        }
        .save-button:active {
            transform: translateY(1px);
        }
        .save-status {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #00b894;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .save-status.show {
            opacity: 1;
        }
        
        .character-header {
            background: #333;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #d4af37;
        }
        
        .about-section {
            background: #333;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            border-left: 4px solid #d4af37;
        }
        
        .about-section h2 {
            margin: 0 0 15px 0;
            color: #d4af37;
            font-size: 1.4em;
        }
        
        .about-section p {
            margin: 0 0 15px 0;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .about-section p:last-child {
            margin-bottom: 0;
        }
        
        .support-link {
            color: #d4af37;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s ease;
        }
        
        .support-link:hover {
            color: #f1c40f;
            text-decoration: underline;
        }
        
        .character-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .new-character-btn, .character-list-btn, .delete-character-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .new-character-btn {
            background: #00b894;
            color: white;
        }
        
        .new-character-btn:hover {
            background: #00a085;
            transform: translateY(-1px);
        }
        
        .character-list-btn {
            background: #0984e3;
            color: white;
        }
        
        .character-list-btn:hover {
            background: #0770c4;
            transform: translateY(-1px);
        }
        
        .delete-character-btn {
            background: #d63031;
            color: white;
        }
        
        .delete-character-btn:hover {
            background: #b71540;
            transform: translateY(-1px);
        }
        
        .character-list {
            background: #3a3a3a;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .character-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #444;
            border-radius: 4px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .character-item:hover {
            border-color: #d4af37;
            transform: translateX(2px);
        }
        
        .character-item.active {
            border-color: #d4af37;
            background: #555;
        }
        
        .character-info {
            flex: 1;
            cursor: pointer;
        }
        
        .character-info strong {
            display: block;
            color: #d4af37;
            margin-bottom: 4px;
        }
        
        .character-info span {
            display: block;
            color: #e0e0e0;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .character-info small {
            color: #aaa;
            font-size: 12px;
        }
        
        .character-item button {
            background: #d63031;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .character-actions {
            display: flex;
            gap: 8px;
        }
        
        .export-btn, .delete-btn {
            background: #00b894;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: #00a085;
            transform: scale(1.05);
        }
        
        .delete-btn {
            background: #d63031;
        }
        
        .delete-btn:hover {
            background: #b71540;
            transform: scale(1.05);
        }
        
        .import-btn {
            background: #0984e3;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
            display: inline-block;
        }
        
        .import-btn:hover {
            background: #0770c4;
            transform: translateY(-1px);
        }
        
        .export-character-btn {
            background: #00b894;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .export-character-btn:hover {
            background: #00a085;
            transform: translateY(-1px);
        }
        
        .export-all-btn {
            background: #fdcb6e;
            color: #2d3436;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .export-all-btn:hover {
            background: #f39c12;
            transform: translateY(-1px);
        }
        
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            background: #3a3a3a;
            border-radius: 6px;
            border: 1px solid #555;
        }
        
        .loading-state h2 {
            color: #d4af37;
            margin-bottom: 20px;
        }
        
        .loading-state p {
            color: #e0e0e0;
            margin-bottom: 30px;
            font-size: 18px;
        }
        
        .back-btn {
            background: #6c5ce7;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: #5f3dc4;
            transform: translateY(-1px);
        }
        
        .character-header h1 {
            color: #d4af37;
            text-align: center;
            margin: 0 0 30px 0;
            font-size: 2.5em;
        }
        
        .url-info {
            background: #333;
            padding: 10px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 12px;
            color: #aaa;
            text-align: center;
        }
        
        .url-info a {
            color: #d4af37;
            text-decoration: none;
        }
        
        .url-info a:hover {
            text-decoration: underline;
        }
        
        /* Print Styles */
        @media print {
            /* Reset page for printing - more aggressive override */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
                border-radius: 0 !important;
                box-shadow: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
                margin: 0 !important;
                padding: 0 !important;
                font-size: 12pt !important;
                line-height: 1.3 !important;
            }
            
            .character-sheet {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                border: 0 none transparent !important;
            }
            
            .section {
                margin-bottom: 20pt !important;
                padding: 0 !important;
                background: white !important;
                border-radius: 0 !important;
                border-left: 0 none transparent !important;
                page-break-inside: avoid !important;
            }
            
            .section h2 {
                color: black !important;
                border-bottom: 1pt solid #333 !important;
                margin-bottom: 15pt !important;
                padding-bottom: 8pt !important;
                font-size: 14pt !important;
            }
            
            .top-section {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 15pt !important;
                margin-bottom: 20pt !important;
            }
            
            .field label {
                color: black !important;
                font-weight: bold !important;
                margin-bottom: 3pt !important;
            }
            
            .field input, .field select {
                border: 1pt solid #ccc !important;
                background: white !important;
                color: black !important;
                padding: 4pt 6pt !important;
                font-size: 11pt !important;
                border-radius: 0 !important;
            }
            
            .ability-scores {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 15pt !important;
            }

            .ability-item {
                background: white !important;
            }
            
            .ability-score {
                background: white !important;
                border: 1pt solid #ccc !important;
                padding: 12pt !important;
                border-radius: 0 !important;
            }
            
            .ability-score h3 {
                color: black !important;
                margin-bottom: 12pt !important;
                font-size: 12pt !important;
            }
            
            .score-inputs {
                gap: 8pt !important;
                margin-bottom: 8pt !important;
            }
            
            .score-inputs input {
                border-radius: 0 !important;
            }
            
            .advantage-checkbox {
                gap: 6pt !important;
            }
            
            .advantage-checkbox input[type="checkbox"] {
                transform: scale(1.2) !important;
            }
            
            .advantage-checkbox label {
                color: black !important;
                font-size: 11pt !important;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 15pt !important;
            }
            
            .stats-grid input {
                border-radius: 0 !important;
            }
            
            .editable-list {
                background: white !important;
                border: 1pt solid #ccc !important;
                padding: 12pt !important;
                border-radius: 0 !important;
            }
            
            .editable-list h3 {
                color: black !important;
                margin-bottom: 12pt !important;
                font-size: 12pt !important;
            }
            
            .list-item {
                border-bottom: 1pt solid #eee !important;
                padding: 0 0 !important;
                background-color: white !important;
            }
            
            .list-item:last-child {
                background: white !important;
                border-bottom: none !important;
            }
            
            .list-item input, .list-item textarea {
                border: 1pt solid #ccc !important;
                background: white !important;
                color: black !important;
                padding: 3pt 5pt !important;
                font-size: 11pt !important;
                border-radius: 0 !important;
            }

            .empty-state {
                background: transparent !important;
            }
            
            .list-item textarea {
                min-height: 40pt !important;
                resize: none !important;
            }
            
            .remove-button {
                background: #f0f0f0 !important;
                color: #666 !important;
                border: 1pt solid #ccc !important;
                padding: 2pt 6pt !important;
                font-size: 10pt !important;
                border-radius: 0 !important;
            }
            
            .add-button {
                background: #f0f0f0 !important;
                color: #666 !important;
                border: 1pt solid #ccc !important;
                padding: 6pt 12pt !important;
                font-size: 11pt !important;
                margin-top: 8pt !important;
                border-radius: 0 !important;
            }
            
            /* Force all section backgrounds to white in print */
            .section > div {
                background: white !important;
            }
            
            .favor-section {
                background: white !important;
                border: 1pt solid #ccc !important;
                padding: 12pt !important;
                border-radius: 0 !important;
            }
            
            .favor-section h3 {
                color: black !important;
                margin-bottom: 10pt !important;
                font-size: 12pt !important;
            }
            
            .favor-group {
                margin-bottom: 15pt !important;
                background: white !important;
            }
            
            .favor-item {
                border-bottom: 1pt solid #eee !important;
                padding: 4pt 0 !important;
            }
            
            .favor-item span {
                color: black !important;
                font-size: 11pt !important;
            }
            
            .favor-item input {
                border: 1pt solid #ccc !important;
                background: white !important;
                color: black !important;
                padding: 2pt 4pt !important;
                font-size: 11pt !important;
                width: 40pt !important;
                border-radius: 0 !important;
            }
            
            .reputation-section {
                background: white !important;
                border: 1pt solid #ccc !important;
                padding: 12pt !important;
                border-radius: 0 !important;
            }
            
            .reputation-item {
                border-bottom: 1pt solid #eee !important;
                background: white !important;
                padding: 8pt 0 !important;
            }
            
            .reputation-item h3 {
                color: black !important;
                margin-bottom: 8pt !important;
                font-size: 12pt !important;
            }
            
            .reputation-item input {
                border: 1pt solid #ccc !important;
                background: white !important;
                color: black !important;
                padding: 2pt 4pt !important;
                font-size: 11pt !important;
                width: 50pt !important;
                border-radius: 0 !important;
            }
            
            /* Force all inputs to have white background in print */
            input, select, textarea,
            .field input, .field select,
            .score-inputs input,
            .list-item input,
            .favor-item input,
            .reputation-item input,
            .ability-title,
            .ability-description {
                background: white !important;
                color: black !important;
                border: 1pt solid #ccc !important;
            }
            
            /* Hide non-essential elements when printing */
            .save-button,
            .add-button,
            .remove-button,
            .back-button,
            .new-character-button,
            .export-button,
            .import-button,
            .delete-button,
            .about-section,
            .url-info,
            .character-header,
            button[type="button"],
            .add-button,
            .export-button,
            .import-button,
            .delete-button,
            .back-button,
            .new-character-button,
            .add-item,
            .remove-btn,
            .loading-state {
                display: none !important;
            }
            
            /* Ensure proper page breaks */
            .section {
                page-break-inside: avoid !important;
            }
            
            /* Force new page for major sections if needed */
            .ability-scores,
            .stats-grid {
                page-break-inside: avoid !important;
            }
            
            /* Optimize spacing for print */
            .character-sheet > div:last-child {
                margin-bottom: 0 !important;
            }
            
            /* Ensure inputs are readable and hide numeric spinners in print */
            input[type="number"] {
                -moz-appearance: textfield !important;
                appearance: textfield !important;
                -webkit-appearance: none !important;
            }
            
            /* Hide numeric input spinners in print */
            input[type="number"]::-webkit-inner-spin-button,
            input[type="number"]::-webkit-outer-spin-button {
                -webkit-appearance: none !important;
                appearance: none !important;
                display: none !important;
            }
            
            /* Remove focus styles for print */
            input:focus, select:focus, textarea:focus {
                outline: none !important;
                border-color: #333 !important;
                box-shadow: none !important;
            }
            
            /* Force all text colors to black for print */
            h1, h2, h3, h4, h5, h6,
            label, span, div, p {
                color: black !important;
            }
            
            /* Specific override for any remaining gold elements */
            .section h2,
            .ability-score h3,
            .field label,
            .editable-list h3,
            .favor-section h3,
            .reputation-item h3 {
                color: black !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // IndexedDB setup
        const DB_NAME = 'PenumbraCityCharacters';
        const DB_VERSION = 1;
        const STORE_NAME = 'characters';

        // Coalition system configuration (Favor & Reputation)
        const COALITIONS = [
            {
                key: 'revolutionists',
                label: 'The Revolutionists',
                factions: [
                    { key: 'children', label: 'The Children' },
                    { key: 'corsori', label: 'The Corsori' },
                    { key: 'doggirls', label: 'The Doggirls' },
                    { key: 'erreniFederation', label: 'The Erreni Federation' },
                    { key: 'gaslamps', label: 'The Gaslamps' },
                    { key: 'hermeticOrder', label: 'The Hermetic Order of Nothing' },
                    { key: 'industrialWorkers', label: 'The Industrial Workers of Harrow' },
                    { key: 'outsiders', label: 'The Outsiders' },
                    { key: 'royalVeterans', label: 'The Royal Veterans Against Everything' }
                ]
            },
            {
                key: 'bulwark',
                label: 'The Bulwark',
                factions: [
                    { key: 'churchOfAthe', label: 'The Church of Athe' },
                    { key: 'gloaming', label: 'The Gloaming' },
                    { key: 'kingsmen', label: 'The Kingsmen' },
                    { key: 'lampreymen', label: 'The Lampreymen' },
                    { key: 'royalArmy', label: 'The Royal Army' },
                    { key: 'silver', label: 'The Silver' }
                ]
            },
            {
                key: 'reasonable',
                label: 'The Reasonable',
                factions: [
                    { key: 'devils', label: 'The Devils' },
                    { key: 'esteemed', label: 'The Esteemed' },
                    { key: 'goeticLodge', label: 'The Goetic Lodge' },
                    { key: 'lordsOfNewOrder', label: 'The Lords of the New Order' },
                    { key: 'skips', label: 'The Skips' }
                ]
            }
        ];

        // Numeric Input Component for consistent styling
        function NumericInput({ value, onChange, min = 0, max = 20, placeholder = "", className = "", style = {} }) {
            return (
                <input
                    type="number"
                    min={min}
                    max={max}
                    value={value}
                    onChange={onChange}
                    placeholder={placeholder}
                    className={className}
                    style={style}
                />
            );
        }

        function CharacterSheet() {
            const [characters, setCharacters] = useState([]);
            const [currentView, setCurrentView] = useState('list'); // 'list' or 'character'
            const [currentCharacter, setCurrentCharacter] = useState(null);
            const [saveStatus, setSaveStatus] = useState('');
            const [isLoading, setIsLoading] = useState(true);

            // IndexedDB functions
            const initDB = () => {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);
                    
                    request.onerror = () => {
                        console.error('IndexedDB error:', request.error);
                        reject(request.error);
                    };
                    
                    request.onsuccess = () => {
                        console.log('IndexedDB opened successfully');
                        resolve(request.result);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        console.log('IndexedDB upgrade needed');
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(STORE_NAME)) {
                            const store = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                            store.createIndex('name', 'name', { unique: false });
                            store.createIndex('created', 'created', { unique: false });
                            console.log('Object store created:', STORE_NAME);
                        }
                    };
                });
            };

            const loadCharacters = async () => {
                try {
                    const db = await initDB();
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        const chars = request.result.sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified));
                        setCharacters(chars);
                        setIsLoading(false);
                    };
                } catch (error) {
                    console.error('Error loading characters:', error);
                    setIsLoading(false);
                }
            };

            const saveCharacter = async (characterData) => {
                console.log('Saving character:', characterData);
                
                try {
                    const db = await initDB();
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    
                    // Remove the id field for new characters to let IndexedDB auto-generate it
                    const characterToSave = {
                        ...characterData,
                        lastModified: new Date().toISOString()
                    };
                    
                    console.log('Character to save:', characterToSave);
                    
                    if (characterData.id) {
                        // Update existing character
                        console.log('Updating existing character with ID:', characterData.id);
                        await store.put(characterToSave);
                        
                        // Update the characters list with the new data
                        setCharacters(prev => prev.map(char => 
                            char.id === characterData.id ? characterToSave : char
                        ));
                        
                        setSaveStatus('Updated!');
                    } else {
                        // Create new character - remove id field completely
                        delete characterToSave.id;
                        console.log('Creating new character without ID:', characterToSave);
                        
                        const request = store.add(characterToSave);
                        request.onsuccess = () => {
                            const newId = request.result;
                            console.log('Character created with ID:', newId);
                            const savedCharacter = { ...characterToSave, id: newId };
                            setCurrentCharacter(savedCharacter);
                            setCharacters(prev => [...prev, savedCharacter]);
                            setSaveStatus('Created!');
                            // Update hash with the new character ID
                            window.location.hash = `character/${newId}`;
                        };
                        request.onerror = () => {
                            console.error('Error creating character:', request.error);
                            setSaveStatus('Error creating!');
                        };
                    }
                    
                    setTimeout(() => setSaveStatus(''), 2000);
                } catch (error) {
                    setSaveStatus('Error saving!');
                    setTimeout(() => setSaveStatus(''), 2000);
                    console.error('Error saving character:', error);
                }
            };

            const deleteCharacter = async (id) => {
                if (!confirm('Are you sure you want to delete this character?')) return;
                
                try {
                    const db = await initDB();
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    await store.delete(id);
                    
                    setCharacters(prev => prev.filter(c => c.id !== id));
                    if (currentCharacter && currentCharacter.id === id) {
                        setCurrentView('list');
                        setCurrentCharacter(null);
                        window.location.hash = 'list';
                    }
                } catch (error) {
                    console.error('Error deleting character:', error);
                }
            };

            const createNewCharacter = async () => {
                console.log('Creating new character...');
                const newChar = {
                    name: '',
                    playerName: '',
                    characterClass: '',
                    homeFaction: '',
                    level: 1,
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    strength: { max: 10, current: 10, advantage: false },
                    speed: { max: 10, current: 10, advantage: false },
                    will: { max: 10, current: 10, advantage: false },
                    knowledge: { max: 10, current: 10, advantage: false },
                    hitPoints: { max: 10, current: 10, perRest: 5 },
                    armorPoints: { max: 5, current: 5 },
                    classAbilities: [],
                    proficiencies: [],
                    attacks: [],
                    armor: [],
                    equipment: [],
                    languages: [],
                    favor: {
                        revolutionists: { children: 0, corsori: 0, doggirls: 0, erreniFederation: 0, gaslamps: 0, hermeticOrder: 0, industrialWorkers: 0, outsiders: 0, royalVeterans: 0 },
                        bulwark: { churchOfAthe: 0, gloaming: 0, kingsmen: 0, lampreymen: 0, royalArmy: 0, silver: 0 },
                        reasonable: { devils: 0, esteemed: 0, goeticLodge: 0, lordsOfNewOrder: 0, skips: 0 }
                    },
                    reputation: { bulwark: 0, reasonable: 0, revolutionists: 0 }
                };
                
                try {
                    const db = await initDB();
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    
                    const request = store.add(newChar);
                    request.onsuccess = () => {
                        const newId = request.result;
                        console.log('Character created with ID:', newId);
                        const savedCharacter = { ...newChar, id: newId };
                        
                        // Add to characters list
                        setCharacters(prev => [...prev, savedCharacter]);
                        
                        // Navigate to the new character
                        setCurrentCharacter(savedCharacter);
                        setCurrentView('character');
                        window.location.hash = `character/${newId}`;
                        
                        setSaveStatus('New character created!');
                        setTimeout(() => setSaveStatus(''), 2000);
                    };
                    
                    request.onerror = () => {
                        console.error('Error creating character:', request.error);
                        setSaveStatus('Error creating character!');
                        setTimeout(() => setSaveStatus(''), 3000);
                    };
                } catch (error) {
                    console.error('Error creating character:', error);
                    setSaveStatus('Error creating character!');
                    setTimeout(() => setSaveStatus(''), 3000);
                }
            };

            const openCharacter = (char) => {
                setCurrentCharacter(char);
                setCurrentView('character');
                window.location.hash = `character/${char.id}`;
            };

            const goBackToList = () => {
                setCurrentView('list');
                setCurrentCharacter(null);
                window.location.hash = 'list';
            };

            const exportCharacter = (character) => {
                const exportData = {
                    version: '1.0',
                    exportedAt: new Date().toISOString(),
                    character: character
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${character.name || 'character'}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                setSaveStatus('Exported!');
                setTimeout(() => setSaveStatus(''), 2000);
            };

            const exportAllCharacters = () => {
                const exportData = {
                    version: '1.0',
                    exportedAt: new Date().toISOString(),
                    characters: characters,
                    totalCharacters: characters.length
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `penumbra-characters-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                setSaveStatus(`Exported ${characters.length} characters!`);
                setTimeout(() => setSaveStatus(''), 3000);
            };

            const importCharacter = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        if (importData.version) {
                            if (importData.character) {
                                // Single character import
                                if (importData.character.name && 
                                    importData.character.strength && 
                                    importData.character.favor) {
                                    
                                    // Create a new character from import data
                                    const importedCharacter = {
                                        ...importData.character,
                                        id: null, // Remove ID so it gets a new one
                                        created: new Date().toISOString(),
                                        lastModified: new Date().toISOString()
                                    };
                                    
                                    setCurrentCharacter(importedCharacter);
                                    setCurrentView('character');
                                    window.location.hash = 'character/new';
                                    
                                    setSaveStatus('Imported! Save to add to your collection.');
                                    setTimeout(() => setSaveStatus(''), 4000);
                                } else {
                                    setSaveStatus('Invalid character data format!');
                                    setTimeout(() => setSaveStatus(''), 3000);
                                }
                            } else if (importData.characters && Array.isArray(importData.characters)) {
                                // Bulk character import
                                const validCharacters = importData.characters.filter(char => 
                                    char.name && char.strength && char.favor
                                );
                                
                                if (validCharacters.length > 0) {
                                    // Add all valid characters to the list
                                    const charactersToAdd = validCharacters.map(char => ({
                                        ...char,
                                        id: null,
                                        created: new Date().toISOString(),
                                        lastModified: new Date().toISOString()
                                    }));
                                    
                                    setCharacters(prev => [...prev, ...charactersToAdd]);
                                    setSaveStatus(`Imported ${validCharacters.length} characters!`);
                                    setTimeout(() => setSaveStatus(''), 4000);
                                } else {
                                    setSaveStatus('No valid characters found in file!');
                                    setTimeout(() => setSaveStatus(''), 3000);
                                }
                            } else {
                                setSaveStatus('Invalid import file format!');
                                setTimeout(() => setSaveStatus(''), 3000);
                            }
                        } else {
                            setSaveStatus('Invalid import file format!');
                            setTimeout(() => setSaveStatus(''), 3000);
                        }
                    } catch (error) {
                        console.error('Import error:', error);
                        setSaveStatus('Error importing file!');
                        setTimeout(() => setSaveStatus(''), 3000);
                    }
                };
                
                reader.readAsText(file);
                // Reset the input so the same file can be imported again
                event.target.value = '';
            };

            // Load characters on component mount
            useEffect(() => {
                loadCharacters();
            }, []);

            // Handle hash routing separately
            useEffect(() => {
                // Handle hash routing
                const handleHashChange = () => {
                    const hash = window.location.hash.slice(1); // Remove the # symbol
                    console.log('Hash change detected:', hash);
                    
                    if (hash.startsWith('character/')) {
                        const characterId = hash.split('/')[1];
                        if (characterId === 'new') {
                            // Don't handle new character creation here - let the button do it
                            console.log('New character hash detected, skipping...');
                            return;
                        } else {
                            const numericId = parseInt(characterId);
                            if (numericId && characters.length > 0) {
                                const character = characters.find(c => c.id === numericId);
                                if (character) {
                                    console.log('Opening character:', character.name);
                                    setCurrentCharacter(character);
                                    setCurrentView('character');
                                } else {
                                    // Character not found, go back to list
                                    console.log('Character not found, redirecting to list');
                                    setCurrentView('list');
                                    setCurrentCharacter(null);
                                    window.location.hash = 'list';
                                }
                            }
                        }
                    } else if (hash === 'list' || hash === '') {
                        console.log('List hash detected');
                        setCurrentView('list');
                        setCurrentCharacter(null);
                    }
                };
                
                // Set initial route
                if (window.location.hash === '') {
                    console.log('Setting initial hash to list');
                    window.location.hash = 'list';
                }
                
                // Listen for hash changes
                window.addEventListener('hashchange', handleHashChange);
                
                // Handle initial hash
                handleHashChange();
                
                return () => {
                    window.removeEventListener('hashchange', handleHashChange);
                };
            }, [characters]);

            // Auto-save on character changes with debouncing
            useEffect(() => {
                if (currentCharacter && currentCharacter.id) {
                    const timeoutId = setTimeout(() => {
                        // Only save if the character has actually changed
                        const existingChar = characters.find(c => c.id === currentCharacter.id);
                        if (existingChar && JSON.stringify(existingChar) !== JSON.stringify(currentCharacter)) {
                            saveCharacter(currentCharacter);
                        }
                    }, 1000);
                    return () => clearTimeout(timeoutId);
                }
            }, [currentCharacter, characters]);

            const updateAbilityScore = (ability, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    [ability]: {
                        ...prev[ability],
                        [field]: field === 'advantage' ? value : Math.max(0, Math.min(20, parseInt(value) || 0))
                    }
                }));
            };

            const updateStat = (stat, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    [stat]: {
                        ...prev[stat],
                        [field]: Math.max(0, parseInt(value) || 0)
                    }
                }));
            };

            const addListItem = (listName, item) => {
                // Allow empty strings for new items (they can be filled in later)
                setCurrentCharacter(prev => ({
                    ...prev,
                    [listName]: [...prev[listName], item || '']
                }));
            };

            const addClassAbility = () => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    classAbilities: [...prev.classAbilities, { title: '', description: '' }]
                }));
            };

            const updateClassAbility = (index, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    classAbilities: prev.classAbilities.map((ability, i) => 
                        i === index ? { ...ability, [field]: value } : ability
                    )
                }));
            };

            const removeClassAbility = (index) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    classAbilities: prev.classAbilities.filter((_, i) => i !== index)
                }));
            };

            const removeListItem = (listName, index) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    [listName]: prev[listName].filter((_, i) => i !== index)
                }));
            };

            const addAttack = () => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    attacks: [...prev.attacks, { name: '', abilityScore: '', damage: '' }]
                }));
            };

            const updateAttack = (index, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    attacks: prev.attacks.map((attack, i) => 
                        i === index ? { ...attack, [field]: value } : attack
                    )
                }));
            };

            const removeAttack = (index) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    attacks: prev.attacks.filter((_, i) => i !== index)
                }));
            };

            const addArmor = () => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    armor: [...prev.armor, { name: '', quality: '', properties: '' }]
                }));
            };

            const updateArmor = (index, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    armor: prev.armor.map((item, i) => 
                        i === index ? { ...item, [field]: value } : item
                    )
                }));
            };

            const removeArmor = (index) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    armor: prev.armor.filter((_, i) => i !== index)
                }));
            };

            const addEquipment = () => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    equipment: [...prev.equipment, { name: '', quality: '', quantity: '' }]
                }));
            };

            const updateEquipment = (index, field, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    equipment: prev.equipment.map((item, i) => 
                        i === index ? { ...item, [field]: value } : item
                    )
                }));
            };

            const removeEquipment = (index) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    equipment: prev.equipment.filter((_, i) => i !== index)
                }));
            };

            const updateFavor = (group, item, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    favor: {
                        ...prev.favor,
                        [group]: {
                            ...prev.favor[group],
                            [item]: Math.max(0, parseInt(value) || 0)
                        }
                    }
                }));
            };

            const updateReputation = (faction, value) => {
                setCurrentCharacter(prev => ({
                    ...prev,
                    reputation: {
                        ...prev.reputation,
                        [faction]: Math.max(0, parseInt(value) || 0)
                    }
                }));
            };

            // Show loading state
            if (isLoading) {
                return (
                    <div className="character-sheet">
                        <div className="loading-state">
                            <h2>Loading Characters...</h2>
                            <p>Please wait while we load your character collection.</p>
                        </div>
                    </div>
                );
            }

            // Render character list view
            if (currentView === 'list') {
                return (
                    <div className="character-sheet">
                        <div className="character-header">
                            <h1>Penumbra City Characters</h1>
                            <div className="character-controls">
                                <button className="new-character-btn" onClick={createNewCharacter}>
                                     New Character
                                </button>
                                <label className="import-btn">
                                     Import Character
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importCharacter}
                                        style={{ display: 'none' }}
                                    />
                                </label>
                                {characters.length > 0 && (
                                    <button className="export-all-btn" onClick={exportAllCharacters}>
                                         Export All ({characters.length})
                                    </button>
                                )}
                            </div>
                        </div>

                        <div className="about-section">
                            <h2>About</h2>
                            <p>
                                This is a character sheet I created to play <em>Penumbra City</em> with my friends. 
                                I am not affiliated with, nor do I own the trademark to Penumbra City.
                            </p>
                            <p>
                                <strong>Support the creators:</strong>
                                <br />
                                <a href="https://www.tangledwilderness.org/shop/p/penumbracitydigitaledition" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   className="support-link">
                                    Get the official Penumbra City Digital Edition
                                </a>
                            </p>
                        </div>



                        {characters.length === 0 ? (
                            <div className="empty-state">
                                <h2>No Characters Yet</h2>
                                <p>Create your first character to get started!</p>
                                <button className="new-character-btn" onClick={createNewCharacter}>
                                     Create First Character
                                </button>
                            </div>
                        ) : (
                            <div className="character-list">
                                {characters.map(char => (
                                    <div key={char.id} className="character-item">
                                        <div className="character-info" onClick={() => openCharacter(char)}>
                                            <strong>{char.name || 'Unnamed Character'}</strong>
                                            <span>{char.characterClass || 'No Class'}</span>
                                            <small>Level {char.level}</small>
                                        </div>
                                        <div className="character-actions">
                                            <button 
                                                className="export-btn" 
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    exportCharacter(char);
                                                }}
                                                title="Export Character"
                                            >
                                                
                                            </button>
                                            <button 
                                                className="delete-btn" 
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    deleteCharacter(char.id);
                                                }}
                                                title="Delete Character"
                                            >
                                                
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            }

            // Render character sheet view
            if (!currentCharacter) {
                return (
                    <div className="character-sheet">
                        <div className="empty-state">
                            <h2>Loading...</h2>
                        </div>
                    </div>
                );
            }

            return (
                <div className="character-sheet">
                    {/* Character Management Header */}
                    <div className="character-header">
                        <div className="character-controls">
                            <button className="back-btn" onClick={goBackToList}>
                                 Back to Characters
                            </button>
                            <button className="save-button" onClick={() => saveCharacter(currentCharacter)}>
                                 Save
                            </button>
                            <button 
                                className="export-character-btn" 
                                onClick={() => exportCharacter(currentCharacter)}
                                title="Export Character"
                            >
                                 Export
                            </button>
                            {currentCharacter.id && (
                                <button className="delete-character-btn" onClick={() => deleteCharacter(currentCharacter.id)}>
                                     Delete
                                </button>
                            )}
                        </div>
                    </div>

                    <div className={`save-status ${saveStatus ? 'show' : ''}`}>
                        {saveStatus}
                    </div>

                    {/* Top Section */}
                    <div className="section">
                        <h2>Character Information</h2>
                        <div className="top-section">
                            <div className="field">
                                <label>Character Name</label>
                                <input
                                    type="text"
                                    value={currentCharacter.name}
                                    onChange={(e) => setCurrentCharacter(prev => ({ ...prev, name: e.target.value }))}
                                    placeholder="Enter character name"
                                />
                            </div>
                            <div className="field">
                                <label>Player Name</label>
                                <input
                                    type="text"
                                    value={currentCharacter.playerName}
                                    onChange={(e) => setCurrentCharacter(prev => ({ ...prev, playerName: e.target.value }))}
                                    placeholder="Enter player name"
                                />
                            </div>
                            <div className="field">
                                <label>Class</label>
                                <input
                                    type="text"
                                    value={currentCharacter.characterClass}
                                    onChange={(e) => setCurrentCharacter(prev => ({ ...prev, characterClass: e.target.value }))}
                                    placeholder="Enter character class"
                                />
                            </div>
                            <div className="field">
                                <label>Home Faction</label>
                                <input
                                    type="text"
                                    value={currentCharacter.homeFaction}
                                    onChange={(e) => setCurrentCharacter(prev => ({ ...prev, homeFaction: e.target.value }))}
                                    placeholder="Enter home faction"
                                />
                            </div>
                            <div className="field">
                                <label>Level</label>
                                <NumericInput
                                    min="1"
                                    max="20"
                                    value={currentCharacter.level}
                                    onChange={(e) => setCurrentCharacter(prev => ({ ...prev, level: Math.max(1, Math.min(20, parseInt(e.target.value) || 1)) }))}
                                />
                            </div>
                        </div>
                    </div>

                    {/* Ability Scores */}
                    <div className="section">
                        <h2>Ability Scores</h2>
                        <div className="ability-scores">
                            <div className="ability-score">
                                <h3>Strength</h3>
                                <div className="score-inputs">
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.strength.max}
                                        onChange={(e) => updateAbilityScore('strength', 'max', e.target.value)}
                                        placeholder="Max"
                                    />
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.strength.current}
                                        onChange={(e) => updateAbilityScore('strength', 'current', e.target.value)}
                                        placeholder="Current"
                                    />
                                </div>
                                <div className="advantage-checkbox">
                                    <input
                                        type="checkbox"
                                        checked={currentCharacter.strength.advantage}
                                        onChange={(e) => updateAbilityScore('strength', 'advantage', e.target.checked)}
                                    />
                                    <label>Advantage on Level Up</label>
                                </div>
                            </div>

                            <div className="ability-score">
                                <h3>Speed</h3>
                                <div className="score-inputs">
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.speed.max}
                                        onChange={(e) => updateAbilityScore('speed', 'max', e.target.value)}
                                        placeholder="Max"
                                    />
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.speed.current}
                                        onChange={(e) => updateAbilityScore('speed', 'current', e.target.value)}
                                        placeholder="Current"
                                    />
                                </div>
                                <div className="advantage-checkbox">
                                    <input
                                        type="checkbox"
                                        checked={currentCharacter.speed.advantage}
                                        onChange={(e) => updateAbilityScore('speed', 'advantage', e.target.checked)}
                                    />
                                    <label>Advantage on Level Up</label>
                                </div>
                            </div>

                            <div className="ability-score">
                                <h3>Will</h3>
                                <div className="score-inputs">
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.will.max}
                                        onChange={(e) => updateAbilityScore('will', 'max', e.target.value)}
                                        placeholder="Max"
                                    />
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.will.current}
                                        onChange={(e) => updateAbilityScore('will', 'current', e.target.value)}
                                        placeholder="Current"
                                    />
                                </div>
                                <div className="advantage-checkbox">
                                    <input
                                        type="checkbox"
                                        checked={currentCharacter.will.advantage}
                                        onChange={(e) => updateAbilityScore('will', 'advantage', e.target.checked)}
                                    />
                                    <label>Advantage on Level Up</label>
                                </div>
                            </div>

                            <div className="ability-score">
                                <h3>Knowledge</h3>
                                <div className="score-inputs">
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.knowledge.max}
                                        onChange={(e) => updateAbilityScore('knowledge', 'max', e.target.value)}
                                        placeholder="Max"
                                    />
                                    <NumericInput
                                        min="0"
                                        max="20"
                                        value={currentCharacter.knowledge.current}
                                        onChange={(e) => updateAbilityScore('knowledge', 'current', e.target.value)}
                                        placeholder="Current"
                                    />
                                </div>
                                <div className="advantage-checkbox">
                                    <input
                                        type="checkbox"
                                        checked={currentCharacter.knowledge.advantage}
                                        onChange={(e) => updateAbilityScore('knowledge', 'advantage', e.target.checked)}
                                    />
                                    <label>Advantage on Level Up</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="section">
                        <h2>Combat Statistics</h2>
                        <div className="stats-row">
                            <div className="field">
                                <label>Hit Points (Max)</label>
                                <NumericInput
                                    min="0"
                                    value={currentCharacter.hitPoints.max}
                                    onChange={(e) => updateStat('hitPoints', 'max', e.target.value)}
                                />
                            </div>
                            <div className="field">
                                <label>Hit Points (Current)</label>
                                <NumericInput
                                    min="0"
                                    value={currentCharacter.hitPoints.current}
                                    onChange={(e) => updateStat('hitPoints', 'current', e.target.value)}
                                />
                            </div>
                            <div className="field">
                                <label>HP Regained per Rest</label>
                                <NumericInput
                                    min="0"
                                    value={currentCharacter.hitPoints.perRest}
                                    onChange={(e) => updateStat('hitPoints', 'perRest', e.target.value)}
                                />
                            </div>
                            <div className="field">
                                <label>Armor Points (Max)</label>
                                <NumericInput
                                    min="0"
                                    value={currentCharacter.armorPoints.max}
                                    onChange={(e) => updateStat('armorPoints', 'max', e.target.value)}
                                />
                            </div>
                            <div className="field">
                                <label>Armor Points (Current)</label>
                                <NumericInput
                                    min="0"
                                    value={currentCharacter.armorPoints.current}
                                    onChange={(e) => updateStat('armorPoints', 'current', e.target.value)}
                                />
                            </div>
                        </div>
                    </div>

                    {/* Class Abilities */}
                    <div className="section">
                        <h2>Class Abilities</h2>
                        <div className="editable-list">
                            {currentCharacter.classAbilities.length === 0 ? (
                                <div className="empty-state">
                                    <p>No class abilities yet. Click "Add Class Ability" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.classAbilities.map((ability, index) => (
                                    <div key={index} className="ability-item">
                                        <div className="ability-header">
                                            <input
                                                type="text"
                                                value={ability.title || ''}
                                                onChange={(e) => updateClassAbility(index, 'title', e.target.value)}
                                                placeholder="Ability title"
                                                className="ability-title"
                                            />
                                            <button onClick={() => removeClassAbility(index)} className="remove-btn">Remove</button>
                                        </div>
                                        <textarea
                                            value={ability.description || ''}
                                            onChange={(e) => updateClassAbility(index, 'description', e.target.value)}
                                            placeholder="Ability description"
                                            className="ability-description"
                                            rows="3"
                                        />
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={addClassAbility}>Add Class Ability</button>
                            </div>
                        </div>
                    </div>

                    {/* Proficiencies */}
                    <div className="section">
                        <h2>Proficiencies</h2>
                        <div className="editable-list">
                            {currentCharacter.proficiencies.length === 0 ? (
                                <div className="empty-state">
                                    <p>No proficiencies yet. Click "Add Proficiency" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.proficiencies.map((proficiency, index) => (
                                    <div key={index} className="list-item">
                                        <input
                                            type="text"
                                            value={proficiency}
                                            onChange={(e) => {
                                                const newProficiencies = [...currentCharacter.proficiencies];
                                                newProficiencies[index] = e.target.value;
                                                setCurrentCharacter(prev => ({ ...prev, proficiencies: newProficiencies }));
                                            }}
                                            placeholder="Enter proficiency"
                                        />
                                        <button onClick={() => removeListItem('proficiencies', index)} className="remove-btn">Remove</button>
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={() => addListItem('proficiencies', '')}>Add Proficiency</button>
                            </div>
                        </div>
                    </div>

                    {/* Attacks */}
                    <div className="section">
                        <h2>Attacks</h2>
                        <div className="editable-list">
                            {currentCharacter.attacks.length === 0 ? (
                                <div className="empty-state">
                                    <p>No attacks yet. Click "Add Attack" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.attacks.map((attack, index) => (
                                    <div key={index} className="list-item">
                                        <input
                                            type="text"
                                            value={attack.name}
                                            onChange={(e) => updateAttack(index, 'name', e.target.value)}
                                            placeholder="Attack name"
                                        />
                                        <input
                                            type="text"
                                            value={attack.abilityScore}
                                            onChange={(e) => updateAttack(index, 'abilityScore', e.target.value)}
                                            placeholder="Ability score"
                                        />
                                        <input
                                            type="text"
                                            value={attack.damage}
                                            onChange={(e) => updateAttack(index, 'damage', e.target.value)}
                                            placeholder="Damage"
                                        />
                                        <button onClick={() => removeAttack(index)} className="remove-btn">Remove</button>
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={addAttack}>Add Attack</button>
                            </div>
                        </div>
                    </div>

                    {/* Armor */}
                    <div className="section">
                        <h2>Armor</h2>
                        <div className="editable-list">
                            {currentCharacter.armor.length === 0 ? (
                                <div className="empty-state">
                                    <p>No armor yet. Click "Add Armor" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.armor.map((item, index) => (
                                    <div key={index} className="list-item">
                                        <input
                                            type="text"
                                            value={item.name}
                                            onChange={(e) => updateArmor(index, 'name', e.target.value)}
                                            placeholder="Armor name"
                                        />
                                        <input
                                            type="text"
                                            value={item.quality}
                                            onChange={(e) => updateArmor(index, 'quality', e.target.value)}
                                            placeholder="Quality"
                                        />
                                        <input
                                            type="text"
                                            value={item.properties}
                                            onChange={(e) => updateArmor(index, 'properties', e.target.value)}
                                            placeholder="Properties"
                                        />
                                        <button onClick={() => removeArmor(index)} className="remove-btn">Remove</button>
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={addArmor}>Add Armor</button>
                            </div>
                        </div>
                    </div>

                    {/* Equipment */}
                    <div className="section">
                        <h2>Equipment</h2>
                        <div className="editable-list">
                            {currentCharacter.equipment.length === 0 ? (
                                <div className="empty-state">
                                    <p>No equipment yet. Click "Add Equipment" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.equipment.map((item, index) => (
                                    <div key={index} className="list-item">
                                        <input
                                            type="text"
                                            value={item.name}
                                            onChange={(e) => updateEquipment(index, 'name', e.target.value)}
                                            placeholder="Item name"
                                        />
                                        <input
                                            type="text"
                                            value={item.quality}
                                            onChange={(e) => updateEquipment(index, 'quality', e.target.value)}
                                            placeholder="Quality"
                                        />
                                        <input
                                            type="text"
                                            value={item.quantity}
                                            onChange={(e) => updateEquipment(index, 'quantity', e.target.value)}
                                            placeholder="Quantity"
                                        />
                                        <button onClick={() => removeEquipment(index)} className="remove-btn">Remove</button>
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={addEquipment}>Add Equipment</button>
                            </div>
                        </div>
                    </div>

                    {/* Languages */}
                    <div className="section">
                        <h2>Languages Spoken</h2>
                        <div className="editable-list">
                            {currentCharacter.languages.length === 0 ? (
                                <div className="empty-state">
                                    <p>No languages yet. Click "Add Language" to get started.</p>
                                </div>
                            ) : (
                                currentCharacter.languages.map((language, index) => (
                                    <div key={index} className="list-item">
                                        <input
                                            type="text"
                                            value={language}
                                            onChange={(e) => {
                                                const newLanguages = [...currentCharacter.languages];
                                                newLanguages[index] = e.target.value;
                                                setCurrentCharacter(prev => ({ ...prev, languages: newLanguages }));
                                            }}
                                            placeholder="Enter language"
                                        />
                                        <button onClick={() => removeListItem('languages', index)} className="remove-btn">Remove</button>
                                    </div>
                                ))
                            )}
                            <div className="add-item">
                                <button onClick={() => addListItem('languages', '')}>Add Language</button>
                            </div>
                        </div>
                    </div>

                    {/* Favor */}
                    <div className="section">
                        <h2>Favor</h2>
                        <div className="favor-section">
                            {COALITIONS.map(coalition => (
                                <div key={coalition.key} className="favor-group">
                                    <h3>{coalition.label}</h3>
                                    {coalition.factions.map(faction => (
                                        <div key={faction.key} className="favor-item">
                                            <span>{faction.label}</span>
                                            <NumericInput
                                                min="0"
                                                value={currentCharacter.favor[coalition.key][faction.key]}
                                                onChange={(e) => updateFavor(coalition.key, faction.key, e.target.value)}
                                            />
                                        </div>
                                    ))}
                                </div>
                            ))}


                        </div>
                    </div>

                    {/* Reputation */}
                    <div className="section">
                        <h2>Reputation</h2>
                        <div className="reputation-section">
                            {COALITIONS.map(coalition => (
                                <div key={coalition.key} className="reputation-item">
                                    <h3>{coalition.label}</h3>
                                    <NumericInput
                                        min="0"
                                        value={currentCharacter.reputation[coalition.key]}
                                        onChange={(e) => updateReputation(coalition.key, e.target.value)}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<CharacterSheet />, document.getElementById('root'));
    </script>
</body>
</html>
